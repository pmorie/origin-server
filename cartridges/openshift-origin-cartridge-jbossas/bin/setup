#!/bin/bash -eu

case "$1" in
  -v|--version)
    version="$2"
esac

# Create additional directories required by JBOSSAS
mkdir -p ${OPENSHIFT_BUILD_DEPENDENCIES_DIR}/.m2
ln -sf ${OPENSHIFT_BUILD_DEPENDENCIES_DIR}/.m2 ${OPENSHIFT_HOMEDIR}/.m2

mkdir -p ${OPENSHIFT_JBOSSAS_DIR}/{template,standalone/tmp,standalone/configuration,standalone/log,standalone/data}

mkdir -p ${OPENSHIFT_DEPENDENCIES_DIR}deployments
ln -sf ${OPENSHIFT_DEPENDENCIES_DIR}deployments standalone/deployments

# Copy the version specific files up to jbossas directory
cp -r ${OPENSHIFT_JBOSSAS_DIR}/versions/${version}/standalone/configuration/* ${OPENSHIFT_JBOSSAS_DIR}/standalone/configuration
cp ${OPENSHIFT_JBOSSAS_DIR}/versions/${version}/bin/* ${OPENSHIFT_JBOSSAS_DIR}/bin

# Initialize the JBoss CLI history file
[ -f ${OPENSHIFT_HOMEDIR}/.jboss-cli-history ] || touch ${OPENSHIFT_HOMEDIR}/.jboss-cli-history
